----------------- Creacion de la base de datos----------------------------

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE DATABASE Registro_Empleados_Departamentos
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

------------------Creacion de las tablas------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE departamento(

   cod_Depar VARCHAR(5) NOT NULL,
   nombre_depar VARCHAR(20) NOT NULL,
   ciudad VARCHAR(10)NOT NULL,
   cod_trabajo VARCHAR(15)NOT NULL,
   PRIMARY KEY(cod_trabajo));

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO departamento VALUES ('1111','GERENCIA','GUAYAQUIL','31.840');
INSERT INTO departamento VALUES ('2222','PRODUCCIÃ“N','QUITO','16.211'); 
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE empleado(
    
    cod_emple VARCHAR(12),
    nombre_emple VARCHAR(15) NOT NULL,
    sexo_emple VARCHAR(2) NOT NULL,
    fecha_nacimiento_emple DATE NOT NULL,
    cargo_emple VARCHAR(15) NOT NULL,
    cod_trabajo VARCHAR(15)NOT NULL,
    sueldo int(9) Not Null,
    edad int(6) not null,
    PRIMARY KEY (cod_emple),
    FOREIGN KEY (cod_trabajo)REFERENCES departamento(cod_trabajo));  

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO empleado VALUES ('12345','Jose Maria','M','2001-01-20','Asesor','16.211');
INSERT INTO empleado VALUES ('67890','Maria Alcivar','f','1999-10-28','Vendedor','31.840');
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE jefe_empleado(

   cod_jefe_emple INT NOT NULL,
   nombre_jefe VARCHAR(15),
   documento CHAR(8),
   sueldo FLOAT (6,2),
   fecha_ingreso DATE,
   cod_trabajo VARCHAR(15)NOT NULL,
   PRIMARY KEY (cod_jefe_emple));

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 INSERT INTO jefe_empleado VALUES ('7895','Juanito Mendoza','0123456784','500','2018-05-01','16.211');
 INSERT INTO jefe_empleado VALUES ('4561','jorge Bermeo','095975614','600','2017-08-09','31.840');
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

 CREATE TABLE jefe_departamentos(
   cod_jefe_depart INT NOT NULL,
   nombre_jefe VARCHAR(15),
   documento CHAR(8),
   sueldo FLOAT (6,2),
   fecha_ingreso DATE,
   cod_trabajo VARCHAR(15)NOT NULL,
   PRIMARY KEY (cod_jefe_depart));
  
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO jefe_departamentos VALUES ('7853','Ernesto Valencia','7845012563','1.150','2019-05-01','16.211');
INSERT INTO jefe_departamentos VALUES ('4444','Karla vera','789451236574','700','2013-08-09','31.840');
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-------------Creacion del procemiento -------------------------------------------------------------------------------------------------------------------------------------------------------

DELIMITER $$

CREATE PROCEDURE `registro_empleados_departamentos`.`PR_total_empleados`()
   
    BEGIN
          SELECT COUNT(*) nombre_emple FROM empleado;
    END$$

DELIMITER ;

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CALL PR_total_empleados;
SELECT COUNT(*); -
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-
------------Creacion de la funcion------------------------------------------------------------------------------------------------------------------------------------------------------------

DELIMITER $$

CREATE
   
    FUNCTION `registro_empleados_departamentos`.`funcion_total_empleados`(empleado_total INT) RETURNS INT(11)

    
    BEGIN
          DECLARE empleado_total INT;
         
                SELECT COUNT(*)
                INTO  empleado_total 
                FROM empleado;
                
                RETURN  empleado_total ;
    END$$

DELIMITER ;-
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

---------------------Creacion del primer trigger---------------------------------------------------------------------------------------------------------------------------------------------------
 DELIMITER $$

CREATE
   
    TRIGGER `registro_empleados_departamentos`.`TR_INSERTAR_REGISTRO` BEFORE INSERT
    ON `registro_empleados_departamentos`.`empleado`
    FOR EACH ROW BEGIN
    
    
    IF NEW.EDAD < 18 THEN
    SET NEW.EDAD = 18 ;
    
    END IF;

    END$$

DELIMITER 

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT INTO empleado VALUES ('1949','Andres','M','1999-11-20','Conserje','16.211',600,23);
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

-------------------Creacion del segundo Trigeer-------------------------------------------------------------------------------------------------------------------------------------------------------
DELIMITER $$

CREATE
    TRIGGER `registro_empleados_departamentos`.`TR_UPDATE_REGISTRO` 
    BEFORE UPDATE ON `registro_empleados_departamentos`.`empleado`
    FOR EACH ROW BEGIN
    
    IF NEW.SUELDO <> OLD.SUELDO THEN
    SET NEW.SUELDO = NEW.SUELDO *2;
    
    END IF;


    END$$

DELIMITER ;

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
UPDATE empleado SET sueldo = 150 WHERE cod_emple = 12345 ;-
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------